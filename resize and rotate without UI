import cv2
import numpy as np

def display_image(image, window_name="Image"):
    cv2.imshow(window_name, image)
    cv2.waitKey(0)
    cv2.destroyAllWindows()

def resize_image(image, scale_x, scale_y):
    height, width = image.shape[:2]
    new_width = int(width * scale_x)
    new_height = int(height * scale_y)
    return cv2.resize(image, (new_width, new_height), interpolation=cv2.INTER_LINEAR)

def rotate_image(image, angle):
    height, width = image.shape[:2]
    center = (width // 2, height // 2)
    matrix = cv2.getRotationMatrix2D(center, angle, 1.0)
    return cv2.warpAffine(image, matrix, (width, height))

def is_binary_image(img):
    if len(img.shape) != 2:  # Must be single-channel
        return False
    unique_values = np.unique(img)
    return len(unique_values) <= 2 and set(unique_values).issubset({0, 255})

def is_grayscale_image(img):
    return len(img.shape) == 2

def is_color_image(img):
    return len(img.shape) == 3 and img.shape[2] == 3

def process_image(img, img_type, image_path):
    if img_type == "binary":
        img = cv2.imread(image_path, cv2.IMREAD_GRAYSCALE)
        if img is None:
            print("Error: Could not load image.")
            return
        _, img = cv2.threshold(img, 127, 255, cv2.THRESH_BINARY)
        if not is_binary_image(img):
            print("Error: Image is not binary.")
            return
    elif img_type == "grayscale":
        img = cv2.imread(image_path, cv2.IMREAD_GRAYSCALE)
        if img is None or not is_grayscale_image(img):
            print("Error: Image is not grayscale.")
            return
    else:  # color
        img = cv2.imread(image_path)
        if img is None or not is_color_image(img):
            print("Error: Image is not a color image.")
            return
    
    while True:
        print(f"\n{img_type.capitalize()} Image Menu:")
        print("1: Resize")
        print("2: Rotate")
        print("3: Back to Image Selection")
        choice = input("Enter choice (1-3): ")
        
        if choice == '1':
            while True:
                print("\nResize Menu:")
                print("1: Upscale")
                print("2: Downscale")
                print("3: Vertical Scaling")
                print("4: Horizontal Scaling")
                print("5: Exit")
                resize_choice = input("Enter choice (1-5): ")
                
                if resize_choice == '1':
                    scaled_img = resize_image(img, 2.0, 2.0)
                    display_image(scaled_img, f"Upscaled {img_type.capitalize()} Image")
                elif resize_choice == '2':
                    scaled_img = resize_image(img, 0.5, 0.5)
                    display_image(scaled_img, f"Downscaled {img_type.capitalize()} Image")
                elif resize_choice == '3':
                    scaled_img = resize_image(img, 1.0, 1.5)
                    display_image(scaled_img, f"Vertically Scaled {img_type.capitalize()} Image")
                elif resize_choice == '4':
                    scaled_img = resize_image(img, 1.5, 1.0)
                    display_image(scaled_img, f"Horizontally Scaled {img_type.capitalize()} Image")
                elif resize_choice == '5':
                    break
                else:
                    print("Invalid choice. Try again.")
        
        elif choice == '2':
            while True:
                angle_input = input("Enter rotation angle (or type 'exit' to stop): ")
                if angle_input.lower() == 'exit':
                    break
                try:
                    angle = float(angle_input)
                    rotated_img = rotate_image(img, angle)
                    display_image(rotated_img, f"{img_type.capitalize()} Image Rotated {angle} Degrees")
                except ValueError:
                    print("Invalid angle. Enter a number or 'exit'.")
        
        elif choice == '3':
            break
        else:
            print("Invalid choice. Try again.")

def main():
    while True:
        print("\nMain Menu:")
        print("1: Binary Image")
        print("2: Grayscale Image")
        print("3: Color Image")
        print("4: Exit")
        choice = input("Enter choice (1-4): ")
        
        if choice == '4':
            print("Exiting program.")
            break
        if choice not in ['1', '2', '3']:
            print("Invalid choice. Try again.")
            continue
        
        image_path = input("Enter the path to the image: ")
        img_type = {"1": "binary", "2": "grayscale", "3": "color"}[choice]
        process_image(None, img_type, image_path)

main()
